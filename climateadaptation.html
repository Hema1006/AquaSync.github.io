<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Resource Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
    --primary: #1976d2;      /* Main blue */
    --secondary: #42a5f5;    /* Lighter blue */
    --accent: #0d47a1;       /* Darker blue */
    --light: #e3f2fd;        /* Very light blue */
    --dark: #263238;
    --danger: #f44336;
    --success: #4caf50;
    --warning: #ff9800;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #f5f5f5;
    color: var(--dark);
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Header removed as requested */

nav {
    background-color: var(--primary);
    padding: 15px 0;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

nav ul {
    display: flex;
    justify-content: center;
    list-style-type: none;
}

nav li {
    margin: 0 15px;
}

nav a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: 4px;
    transition: all 0.3s;
}

nav a:hover, nav a.active {
    background-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.tabs {
    margin: 20px 0;
}

.tab-buttons {
    display: flex;
    background-color: white;
    border-radius: 8px 8px 0 0;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.tab-button {
    padding: 15px 20px;
    border: none;
    background-color: white;
    cursor: pointer;
    flex-grow: 1;
    font-weight: 500;
    transition: all 0.3s;
}

.tab-button:hover {
    background-color: var(--light);
}

.tab-button.active {
    background-color: var(--primary);
    color: white;
}

.tab-content {
    background-color: white;
    padding: 25px;
    border-radius: 0 0 8px 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

.card {
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}

.card-title {
    font-size: 1.3rem;
    margin-bottom: 15px;
    color: var(--primary);
    border-bottom: 2px solid var(--light);
    padding-bottom: 8px;
}

.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--dark);
}

input, select, textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
}

button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    font-weight: 500;
}

button:hover {
    background-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.btn-danger {
    background-color: var(--danger);
}

.btn-success {
    background-color: var(--success);
}

.btn-warning {
    background-color: var(--warning);
}

.alert {
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.alert-warning {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

th, td {
    padding: 15px 20px;
    text-align: left;
}

th {
    background-color: var(--primary);
    color: white;
    font-weight: 600;
}

tr:nth-child(even) {
    background-color: var(--light);
}

tr:hover {
    background-color: rgba(25, 118, 210, 0.1);
}

td {
    border-bottom: 1px solid #e0e0e0;
}

.badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    display: inline-block;
}

.badge-primary {
    background-color: var(--primary);
    color: white;
}

.badge-success {
    background-color: var(--success);
    color: white;
}

.badge-danger {
    background-color: var(--danger);
    color: white;
}

.badge-warning {
    background-color: var(--warning);
    color: white;
}

.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.stat-card {
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
    border-top: 4px solid var(--primary);
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    margin: 15px 0;
}

.stat-label {
    color: #666;
    font-size: 1rem;
    font-weight: 500;
}

.chart-container {
    position: relative;
    height: 350px;
    margin-bottom: 30px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.search-bar {
    display: flex;
    margin-bottom: 25px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
}

.search-bar input {
    flex-grow: 1;
    margin: 0;
    border-radius: 0;
    border: none;
    padding: 15px;
}

.search-bar button {
    border-radius: 0;
    padding: 15px 25px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 25px;
}

.weather-info {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.weather-icon {
    font-size: 3.5rem;
    margin-right: 25px;
    color: var(--primary);
}

.weather-details h3 {
    margin-bottom: 8px;
    color: var(--primary);
}

.request-card, .supply-card {
    border-left: 5px solid;
    padding: 20px;
    margin-bottom: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
}

.request-card:hover, .supply-card:hover {
    transform: translateY(-5px);
}

.request-card {
    border-left-color: var(--warning);
}

.supply-card {
    border-left-color: var(--success);
}

.card-actions {
    display: flex;
    justify-content: flex-end;
    margin-top: 15px;
}

.card-actions button {
    margin-left: 10px;
}

@media (max-width: 768px) {
    .grid {
        grid-template-columns: 1fr;
    }
    
    nav ul {
        flex-direction: column;
        align-items: center;
    }
    
    nav li {
        margin: 5px 0;
    }
    
    .tab-buttons {
        flex-direction: column;
    }
    
    .dashboard-stats {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <header>
        <div class="container">
           
        </div>
    </header>
    
    <nav>
        <div class="container">
            <ul>
                <li><a href="#" class="active" onclick="switchTab('dashboard')">Dashboard</a></li>
                <li><a href="#" onclick="switchTab('request')">Request Water</a></li>
                <li><a href="#" onclick="switchTab('supply')">Supply Water</a></li>
                <li><a href="#" onclick="switchTab('profile')">My Profile</a></li>
                <li><a href="#" onclick="switchTab('users')">Search Users</a></li>
                <li><a href="#" onclick="switchTab('analysis')">Drought Analysis</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <div id="alerts"></div>
        
        <div class="tabs">
            <div class="tab-content">
                <div id="tab-dashboard" class="tab-pane active">
                    <h2>Dashboard</h2>
                    
                    <div class="weather-info card">
                        <div class="weather-icon" id="weather-icon">‚õÖ</div>
                        <div class="weather-details">
                            <h3>Current Weather</h3>
                            <p id="weather-description">Loading weather data...</p>
                            <p id="weather-temp">--¬∞C</p>
                            <p id="weather-humidity">Humidity: --%</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-label">Current Requests</div>
                            <div class="stat-value" id="stats-requests">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Available Supply</div>
                            <div class="stat-value" id="stats-supply">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Your Requests</div>
                            <div class="stat-value" id="stats-your-requests">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Your Supply</div>
                            <div class="stat-value" id="stats-your-supply">0</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Drought Prediction</h3>
                        <div id="drought-alert"></div>
                        <div class="chart-container">
                            <canvas id="drought-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h3 class="card-title">Latest Water Requests</h3>
                            <div id="latest-requests">Loading...</div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">Latest Water Supply</h3>
                            <div id="latest-supply">Loading...</div>
                        </div>
                    </div>
                </div>
                
                <div id="tab-request" class="tab-pane">
                    <h2>Request Water</h2>
                    <div class="card">
                        <form id="request-form">
                            <div class="form-group">
                                <label for="request-amount">Amount Needed (Liters)</label>
                                <input type="number" id="request-amount" required min="1">
                            </div>
                            <div class="form-group">
                                <label for="request-urgency">Urgency Level</label>
                                <select id="request-urgency" required>
                                    <option value="low">Low - Within next week</option>
                                    <option value="medium">Medium - Within next 48 hours</option>
                                    <option value="high">High - Immediate need</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="request-reason">Reason for Request</label>
                                <textarea id="request-reason" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="request-location">Delivery Location</label>
                                <input type="text" id="request-location" required>
                            </div>
                            <button type="submit">Submit Request</button>
                        </form>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Your Active Requests</h3>
                        <div id="user-requests">Loading your requests...</div>
                    </div>
                </div>
                
                <div id="tab-supply" class="tab-pane">
                    <h2>Supply Water</h2>
                    <div class="card">
                        <form id="supply-form">
                            <div class="form-group">
                                <label for="supply-amount">Amount Available (Liters)</label>
                                <input type="number" id="supply-amount" required min="1">
                            </div>
                            <div class="form-group">
                                <label for="supply-duration">Available Until</label>
                                <input type="date" id="supply-duration" required>
                            </div>
                            <div class="form-group">
                                <label for="supply-quality">Water Quality</label>
                                <select id="supply-quality" required>
                                    <option value="potable">Potable - Drinking water</option>
                                    <option value="filtered">Filtered - Safe for most uses</option>
                                    <option value="non-potable">Non-potable - Agricultural/Cleaning use only</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="supply-location">Pickup Location</label>
                                <input type="text" id="supply-location" required>
                            </div>
                            <div class="form-group">
                                <label for="supply-notes">Additional Notes</label>
                                <textarea id="supply-notes" rows="3"></textarea>
                            </div>
                            <button type="submit">Offer Supply</button>
                        </form>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Your Active Supply Offerings</h3>
                        <div id="user-supply">Loading your supply offerings...</div>
                    </div>
                </div>
                
                <div id="tab-profile" class="tab-pane">
                    <h2>My Profile</h2>
                    <div class="card">
                        <form id="profile-form">
                            <div class="form-group">
                                <label for="profile-name">Full Name</label>
                                <input type="text" id="profile-name" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-email">Email Address</label>
                                <input type="email" id="profile-email" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-phone">Phone Number</label>
                                <input type="tel" id="profile-phone" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-address">Address</label>
                                <textarea id="profile-address" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="profile-city">City</label>
                                <input type="text" id="profile-city" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-zipcode">Zip/Postal Code</label>
                                <input type="text" id="profile-zipcode" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-notifications">Notification Preferences</label>
                                <select id="profile-notifications" required>
                                    <option value="email">Email Only</option>
                                    <option value="sms">SMS Only</option>
                                    <option value="both">Both Email and SMS</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                            <button type="submit">Update Profile</button>
                        </form>
                    </div>
                </div>
                
                <div id="tab-users" class="tab-pane">
                    <h2>Search Users</h2>
                    <div class="card">
                        <div class="search-bar">
                            <input type="text" id="user-search" placeholder="Search by name, location, or city...">
                            <button id="search-button">Search</button>
                        </div>
                        
                        <div id="search-results">
                            <p>Enter search terms to find users</p>
                        </div>
                    </div>
                </div>
                
                <div id="tab-analysis" class="tab-pane">
                    <h2>Drought Analysis</h2>
                    <div class="card">
                        <h3 class="card-title">Drought Prediction Model</h3>
                        <div id="model-status">Loading drought prediction model...</div>
                        <div class="chart-container">
                            <canvas id="rainfall-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Historical Data</h3>
                        <div class="chart-container">
                            <canvas id="historical-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Emergency Alert Settings</h3>
                        <form id="alert-settings-form">
                            <div class="form-group">
                                <label for="alert-threshold">Drought Alert Threshold (%)</label>
                                <input type="number" id="alert-threshold" min="0" max="100" value="70">
                            </div>
                            <div class="form-group">
                                <label for="alert-notification">Receive Alert Notifications</label>
                                <select id="alert-notification">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <button type="submit">Save Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global Variables
        const WEATHER_API_KEY = "30b57a5487db153e1bdf17c1e9d33f44";
        const GEMINI_API_KEY = "AIzaSyDlIRYdegfbkLXq83OBIotfavhoXHqdHvE";
        const MONGODB_URL = "mongodb://localhost:27017/";
        
        let currentUser = null;
        let droughtModel = null;
        let weatherData = null;
        let droughtPrediction = null;
        let requests = [];
        let supplies = [];
        let users = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });
        
        async function initApp() {
            // Load the current user (simulated)
            await loadCurrentUser();
            
            // Load weather data
            await fetchWeatherData();
            
            // Initialize the drought prediction model
            await initDroughtModel();
            
            // Load water requests and supplies
            await loadWaterData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update UI
            updateDashboard();
        }
        
        // Simulated database functions (MongoDB connection would be handled on server-side)
        // In a real implementation, these would be API calls to a backend server
        
        async function loadCurrentUser() {
            // Simulate loading user from database
            // In real application, this would be an authenticated user
            try {
                showAlert("Loading user profile...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                currentUser = {
                    _id: "user123",
                    name: "John Smith",
                    email: "john.smith@example.com",
                    phone: "555-123-4567",
                    address: "123 Main Street",
                    city: "Watertown",
                    zipcode: "12345",
                    location: { lat: 40.7128, lng: -74.0060 },
                    notifications: "email",
                    created: new Date(),
                    lastLogin: new Date()
                };
                
                // Fill the profile form with user data
                document.getElementById('profile-name').value = currentUser.name;
                document.getElementById('profile-email').value = currentUser.email;
                document.getElementById('profile-phone').value = currentUser.phone;
                document.getElementById('profile-address').value = currentUser.address;
                document.getElementById('profile-city').value = currentUser.city;
                document.getElementById('profile-zipcode').value = currentUser.zipcode;
                document.getElementById('profile-notifications').value = currentUser.notifications;
                
                showAlert("User profile loaded successfully", "success");
            } catch (error) {
                console.error("Error loading user:", error);
                showAlert("Failed to load user profile. Please try again.", "danger");
            }
        }
        
        async function loadWaterData() {
            try {
                showAlert("Loading water resources data...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate requests from MongoDB
                requests = [
                    {
                        _id: "req001",
                        userId: "user456",
                        userName: "Jane Doe",
                        amount: 500,
                        urgency: "medium",
                        reason: "Household use during pipe repairs",
                        location: "45 Park Avenue, Watertown",
                        status: "active",
                        created: new Date(Date.now() - 86400000)
                    },
                    {
                        _id: "req002",
                        userId: "user789",
                        userName: "Robert Brown",
                        amount: 2000,
                        urgency: "high",
                        reason: "Community garden emergency",
                        location: "789 Garden Road, Watertown",
                        status: "active",
                        created: new Date(Date.now() - 43200000)
                    },
                    {
                        _id: "req003",
                        userId: "user123", // Current user
                        userName: "John Smith",
                        amount: 350,
                        urgency: "low",
                        reason: "Store additional water for upcoming maintenance",
                        location: "123 Main Street, Watertown",
                        status: "active",
                        created: new Date(Date.now() - 129600000)
                    }
                ];
                
                // Simulate supplies from MongoDB
                supplies = [
                    {
                        _id: "sup001",
                        userId: "user101",
                        userName: "Emily Wilson",
                        amount: 1000,
                        availableUntil: new Date(Date.now() + 259200000),
                        quality: "potable",
                        location: "202 River Road, Watertown",
                        notes: "Available for pickup between 9 AM and 5 PM",
                        status: "active",
                        created: new Date(Date.now() - 172800000)
                    },
                    {
                        _id: "sup002",
                        userId: "user123", // Current user
                        userName: "John Smith",
                        amount: 750,
                        availableUntil: new Date(Date.now() + 432000000),
                        quality: "filtered",
                        location: "123 Main Street, Watertown",
                        notes: "Call before pickup",
                        status: "active",
                        created: new Date(Date.now() - 86400000)
                    },
                    {
                        _id: "sup003",
                        userId: "user202",
                        userName: "Michael Johnson",
                        amount: 3000,
                        availableUntil: new Date(Date.now() + 604800000),
                        quality: "non-potable",
                        location: "55 Farm Road, Watertown",
                        notes: "Agricultural use only, large quantities available",
                        status: "active",
                        created: new Date(Date.now() - 259200000)
                    }
                ];
                
                // Simulate users from MongoDB
                users = [
                    currentUser,
                    {
                        _id: "user456",
                        name: "Jane Doe",
                        email: "jane.doe@example.com",
                        phone: "555-987-6543",
                        address: "45 Park Avenue",
                        city: "Watertown",
                        zipcode: "12345",
                        location: { lat: 40.7120, lng: -74.0050 }
                    },
                    {
                        _id: "user789",
                        name: "Robert Brown",
                        email: "robert.brown@example.com",
                        phone: "555-456-7890",
                        address: "789 Garden Road",
                        city: "Watertown",
                        zipcode: "12345",
                        location: { lat: 40.7140, lng: -74.0070 }
                    },
                    {
                        _id: "user101",
                        name: "Emily Wilson",
                        email: "emily.wilson@example.com",
                        phone: "555-321-6549",
                        address: "202 River Road",
                        city: "Watertown",
                        zipcode: "12345",
                        location: { lat: 40.7115, lng: -74.0040 }
                    },
                    {
                        _id: "user202",
                        name: "Michael Johnson",
                        email: "michael.johnson@example.com",
                        phone: "555-789-1234",
                        address: "55 Farm Road",
                        city: "Watertown",
                        zipcode: "12345",
                        location: { lat: 40.7150, lng: -74.0090 }
                    }
                ];
                
                updateRequestsUI();
                updateSupplyUI();
                showAlert("Water resources data loaded successfully", "success");
            } catch (error) {
                console.error("Error loading water data:", error);
                showAlert("Failed to load water resources data. Please try again.", "danger");
            }
        }
        
        async function saveRequest(requestData) {
            try {
                showAlert("Submitting water request...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Create a new request object
                const newRequest = {
                    _id: "req" + Date.now(),
                    userId: currentUser._id,
                    userName: currentUser.name,
                    amount: parseInt(requestData.amount),
                    urgency: requestData.urgency,
                    reason: requestData.reason,
                    location: requestData.location,
                    status: "active",
                    created: new Date()
                };
                
                // Add to the requests array (in real app, save to MongoDB)
                requests.push(newRequest);
                
                // Update UI
                updateRequestsUI();
                updateDashboard();
                
                showAlert("Water request submitted successfully", "success");
                return newRequest;
            } catch (error) {
                console.error("Error saving request:", error);
                showAlert("Failed to submit water request. Please try again.", "danger");
                throw error;
            }
        }
        
        async function saveSupply(supplyData) {
            try {
                showAlert("Submitting water supply offering...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Create a new supply object
                const newSupply = {
                    _id: "sup" + Date.now(),
                    userId: currentUser._id,
                    userName: currentUser.name,
                    amount: parseInt(supplyData.amount),
                    availableUntil: new Date(supplyData.duration),
                    quality: supplyData.quality,
                    location: supplyData.location,
                    notes: supplyData.notes,
                    status: "active",
                    created: new Date()
                };
                
                // Add to the supplies array (in real app, save to MongoDB)
                supplies.push(newSupply);
                
                // Update UI
                updateSupplyUI();
                updateDashboard();
                
                showAlert("Water supply offering submitted successfully", "success");
                return newSupply;
            } catch (error) {
                console.error("Error saving supply:", error);
                showAlert("Failed to submit water supply offering. Please try again.", "danger");
                throw error;
            }
        }
        
        async function saveUserProfile(profileData) {
            try {
                showAlert("Updating user profile...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Update user object
                currentUser.name = profileData.name;
                currentUser.email = profileData.email;
                currentUser.phone = profileData.phone;
                currentUser.address = profileData.address;
                currentUser.city = profileData.city;
                currentUser.zipcode = profileData.zipcode;
                currentUser.notifications = profileData.notifications;
                
                // In real app, save to MongoDB
                
                showAlert("User profile updated successfully", "success");
                return currentUser;
            } catch (error) {
                console.error("Error saving profile:", error);
                showAlert("Failed to update user profile. Please try again.", "danger");
                throw error;
            }
        }
        
        async function searchUsers(query) {
            try {
                showAlert("Searching users...", "info");
                
                // Simulated API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Filter users based on search query
                const query_lower = query.toLowerCase();
                const results = users.filter(user => 
                    user.name.toLowerCase().includes(query_lower) || 
                    user.city.toLowerCase().includes(query_lower) || 
                    user.address.toLowerCase().includes(query_lower)
                );
                
                showAlert(`Found ${results.length} user(s) matching your search`, "success");
                return results;
            } catch (error) {
                console.error("Error searching users:", error);
                showAlert("Failed to search users. Please try again.", "danger");
                throw error;
            }
        }
        
        // Weather API functions
        // Function to get user's current location
async function getUserLocation() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            showAlert("Geolocation is not supported by your browser", "warning");
            reject(new Error("Geolocation not supported"));
            return;
        }
        
        showAlert("Requesting location access...", "info");
        
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const coordinates = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                };
                showAlert("Location access granted", "success");
                resolve(coordinates);
            },
            (error) => {
                console.error("Error getting location:", error);
                showAlert("Location access denied. Using default location.", "warning");
                reject(error);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            }
        );
    });
}

// Modified fetchWeatherData function to use geolocation
async function fetchWeatherData() {
    try {
        showAlert("Fetching weather data...", "info");
        
        let coordinates;
        try {
            // Get user's actual location
            coordinates = await getUserLocation();
        } catch (error) {
            // Fallback to default city if location access is denied
            const city = currentUser ? currentUser.city : "Watertown";
            console.log("Using default city:", city);
        }
        
        // In a real app, you would use these coordinates with the OpenWeather API
        // For demo purposes, simulate the API response
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // If we have coordinates, we would use them in a real API call
        // For demo purposes, just show that we got them
        let city;
        if (coordinates) {
            console.log(`Using coordinates: Lat ${coordinates.latitude}, Lng ${coordinates.longitude}`);
            // In a real app, you might use reverse geocoding to get the city name
            // For this demo, we'll just use coordinates as city name
            city = `Lat: ${coordinates.latitude.toFixed(2)}, Lng: ${coordinates.longitude.toFixed(2)}`;
        } else {
            city = currentUser ? currentUser.city : "Watertown";
        }
        
        weatherData = {
            main: {
                temp: 28.5,
                humidity: 65
            },
            weather: [
                {
                    main: "Clouds",
                    description: "scattered clouds"
                }
            ],
            rain: {
                "1h": 0,
                "3h": 0
            },
            name: city
        };
        
        // Update weather UI
        updateWeatherUI();
        
        // Use weather data to update drought prediction
        updateDroughtPrediction();
        
        showAlert("Weather data updated", "success");
    } catch (error) {
        console.error("Error fetching weather data:", error);
        showAlert("Failed to fetch weather data. Using cached data if available.", "warning");
    }
}
                // Update weather UI
                updateWeatherUI();
                
                // Use weather data to update drought prediction
                updateDroughtPrediction();
                
                showAlert("Weather data updated", "success");
            
        // ML Model for Drought Prediction
        async function initDroughtModel() {
            try {
                showAlert("Initializing drought prediction model...", "info");
                
                document.getElementById('model-status').textContent = "Loading model...";
                
                // In a real application, we would load a pre-trained TensorFlow.js model
                // For demo purposes, we'll create a simple model
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Create a simple sequential model
                droughtModel = tf.sequential();
                
                // Add layers to the model
                droughtModel.add(tf.layers.dense({
                    inputShape: [3], // temp, humidity, rainfall
                    units: 10,
                    activation: 'relu'
                }));
                
                droughtModel.add(tf.layers.dense({
                    units: 5,
                    activation: 'relu'
                }));
                
                droughtModel.add(tf.layers.dense({
                    units: 1,
                    activation: 'sigmoid' // Output is drought probability (0-1)
                }));
                
                // Compile the model
                droughtModel.compile({
                    optimizer: tf.train.adam(),
                    loss: 'binaryCrossentropy',
                    metrics: ['accuracy']
                });
                
                // In a real application, we would either load pre-trained weights
                // or train the model with historical data
                // For demo purposes, we'll use randomly initialized weights
                
                document.getElementById('model-status').textContent = "Model loaded successfully!";
                
                // Generate some historical data for the chart
                generateHistoricalData();
                
                // Update drought prediction
                updateDroughtPrediction();
                
                showAlert("Drought prediction model initialized", "success");
            } catch (error) {
                console.error("Error initializing drought model:", error);
                document.getElementById('model-status').textContent = "Failed to load model. Please refresh.";
                showAlert("Failed to initialize drought prediction model.", "danger");
            }
        }
        
        async function updateDroughtPrediction() {
            try {
                if (!droughtModel || !weatherData) {
                    return;
                }
                
                // Extract features from weather data
                const temp = weatherData.main.temp;
                const humidity = weatherData.main.humidity;
                const rainfall = weatherData.rain && weatherData.rain["1h"] ? weatherData.rain["1h"] : 0;
                
                // Normalize features (simple normalization for demo)
                const normTemp = temp / 40; // Assuming max temp is 40¬∞C
                const normHumidity = humidity / 100;
                const normRainfall = rainfall / 25; // Assuming max rainfall is 25mm/h
                
                // Create input tensor
                const input = tf.tensor2d([[normTemp, normHumidity, normRainfall]]);
                
                // Get prediction from model
                const prediction = await droughtModel.predict(input);
                const probability = await prediction.dataSync()[0];
                
                // Set drought prediction
                droughtPrediction = probability;
                
                // Update drought alert UI
                updateDroughtAlertUI();
                
                // Update drought chart
                updateDroughtChart();
            } catch (error) {
                console.error("Error updating drought prediction:", error);
                showAlert("Failed to update drought prediction.", "warning");
            }
        }
        
        // UI update functions
        function updateWeatherUI() {
            if (!weatherData) {
                return;
            }
            
            const iconElem = document.getElementById('weather-icon');
            const descElem = document.getElementById('weather-description');
            const tempElem = document.getElementById('weather-temp');
            const humidityElem = document.getElementById('weather-humidity');
            
            // Set weather icon
            switch (weatherData.weather[0].main) {
                case 'Clear':
                    iconElem.textContent = '‚òÄÔ∏è';
                    break;
                case 'Clouds':
                    iconElem.textContent = '‚òÅÔ∏è';
                    break;
                case 'Rain':
                case 'Drizzle':
                    iconElem.textContent = 'üåßÔ∏è';
                    break;
                case 'Thunderstorm':
                    iconElem.textContent = '‚õàÔ∏è';
                    break;
                case 'Snow':
                    iconElem.textContent = '‚ùÑÔ∏è';
                    break;
                case 'Fog':
                case 'Mist':
                    iconElem.textContent = 'üå´Ô∏è';
                    break;
                default:
                    iconElem.textContent = '‚õÖ';
            }
            
            // Set weather description
            descElem.textContent = `${weatherData.weather[0].main} - ${weatherData.weather[0].description} in ${weatherData.name}`;
            
            // Set temperature and humidity
            tempElem.textContent = `${weatherData.main.temp.toFixed(1)}¬∞C`;
            humidityElem.textContent = `Humidity: ${weatherData.main.humidity}%`;
        }
        
        function updateDroughtAlertUI() {
            const alertElem = document.getElementById('drought-alert');
            
            if (!droughtPrediction) {
                alertElem.innerHTML = '<p>Drought prediction not available</p>';
                return;
            }
            
            // Convert probability to percentage
            const percentage = (droughtPrediction * 100).toFixed(1);
            
            let alertClass = '';
            let alertMessage = '';
            
            if (droughtPrediction < 0.3) {
                alertClass = 'alert-success';
                alertMessage = `Low drought risk (${percentage}%). Water resources are currently stable.`;
            } else if (droughtPrediction < 0.7) {
                alertClass = 'alert-warning';
                alertMessage = `Moderate drought risk (${percentage}%). Consider conservation measures.`;
            } else {
                alertClass = 'alert-danger';
                alertMessage = `High drought risk (${percentage}%). Emergency water conservation required!`;
            }
            
            alertElem.innerHTML = `<div class="alert ${alertClass}">${alertMessage}</div>`;
        }
        
        function updateDashboard() {
            // Update dashboard statistics
            document.getElementById('stats-requests').textContent = requests.filter(r => r.status === 'active').length;
            document.getElementById('stats-supply').textContent = supplies.filter(s => s.status === 'active').length;
            document.getElementById('stats-your-requests').textContent = requests.filter(r => r.userId === currentUser._id && r.status === 'active').length;
            document.getElementById('stats-your-supply').textContent = supplies.filter(s => s.userId === currentUser._id && s.status === 'active').length;
            
            // Update latest requests
            const latestRequests = requests
                .filter(r => r.status === 'active')
                .sort((a, b) => b.created - a.created)
                .slice(0, 3);
                
            const requestsElem = document.getElementById('latest-requests');
            if (latestRequests.length === 0) {
                requestsElem.innerHTML = '<p>No active water requests</p>';
            } else {
                let html = '';
                latestRequests.forEach(req => {
                    const urgencyClass = req.urgency === 'high' ? 'badge-danger' : (req.urgency === 'medium' ? 'badge-warning' : 'badge-primary');
                    html += `
                        <div class="request-card">
                            <div><strong>${req.userName}</strong> <span class="badge ${urgencyClass}">${req.urgency} urgency</span></div>
                            <div>${req.amount} liters needed</div>
                            <div><small>${formatDate(req.created)}</small></div>
                            <div>${req.reason}</div>
                            <div class="card-actions">
                                <button class="btn-success" onclick="respondToRequest('${req._id}')">Respond</button>
                            </div>
                        </div>
                    `;
                });
                requestsElem.innerHTML = html;
            }
            
            // Update latest supply
            const latestSupply = supplies
                .filter(s => s.status === 'active')
                .sort((a, b) => b.created - a.created)
                .slice(0, 3);
                
            const supplyElem = document.getElementById('latest-supply');
            if (latestSupply.length === 0) {
                supplyElem.innerHTML = '<p>No active water supply offerings</p>';
            } else {
                let html = '';
                latestSupply.forEach(sup => {
                    const qualityClass = sup.quality === 'potable' ? 'badge-success' : (sup.quality === 'filtered' ? 'badge-primary' : 'badge-warning');
                    html += `
                        <div class="supply-card">
                            <div><strong>${sup.userName}</strong> <span class="badge ${qualityClass}">${sup.quality} water</span></div>
                            <div>${sup.amount} liters available</div>
                            <div><small>Until ${formatDate(sup.availableUntil)}</small></div>
                            <div>${sup.notes || 'No additional notes'}</div>
                            <div class="card-actions">
                                <button class="btn-success" onclick="requestSupply('${sup._id}')">Request</button>
                            </div>
                        </div>
                    `;
                });
                supplyElem.innerHTML = html;
            }
        }
        
        function updateRequestsUI() {
            // Update user requests
            const userRequests = requests.filter(r => r.userId === currentUser._id);
            
            const userRequestsElem = document.getElementById('user-requests');
            if (userRequests.length === 0) {
                userRequestsElem.innerHTML = '<p>You have no active water requests</p>';
            } else {
                let html = '<table><thead><tr><th>Date</th><th>Amount</th><th>Urgency</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
                userRequests.forEach(req => {
                    const urgencyClass = req.urgency === 'high' ? 'badge-danger' : (req.urgency === 'medium' ? 'badge-warning' : 'badge-primary');
                    html += `
                        <tr>
                            <td>${formatDate(req.created)}</td>
                            <td>${req.amount} liters</td>
                            <td><span class="badge ${urgencyClass}">${req.urgency}</span></td>
                            <td>${req.status}</td>
                            <td>
                                <button class="btn-danger" onclick="cancelRequest('${req._id}')">Cancel</button>
                            </td>
                        </tr>
                    `;
                });
                html += '</tbody></table>';
                userRequestsElem.innerHTML = html;
            }
        }
        
        function updateSupplyUI() {
            // Update user supply
            const userSupply = supplies.filter(s => s.userId === currentUser._id);
            
            const userSupplyElem = document.getElementById('user-supply');
            if (userSupply.length === 0) {
                userSupplyElem.innerHTML = '<p>You have no active water supply offerings</p>';
            } else {
                let html = '<table><thead><tr><th>Date</th><th>Amount</th><th>Quality</th><th>Available Until</th><th>Actions</th></tr></thead><tbody>';
                userSupply.forEach(sup => {
                    const qualityClass = sup.quality === 'potable' ? 'badge-success' : (sup.quality === 'filtered' ? 'badge-primary' : 'badge-warning');
                    html += `
                        <tr>
                            <td>${formatDate(sup.created)}</td>
                            <td>${sup.amount} liters</td>
                            <td><span class="badge ${qualityClass}">${sup.quality}</span></td>
                            <td>${formatDate(sup.availableUntil)}</td>
                            <td>
                                <button class="btn-danger" onclick="cancelSupply('${sup._id}')">Cancel</button>
                            </td>
                        </tr>
                    `;
                });
                html += '</tbody></table>';
                userSupplyElem.innerHTML = html;
            }
        }
        
        // Chart functions
        function updateDroughtChart() {
            const ctx = document.getElementById('drought-chart').getContext('2d');
            
            // Create prediction data for next 7 days (simulated)
            const labels = [];
            const data = [];
            
            const today = new Date();
            const baseProb = droughtPrediction || 0.5;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                labels.push(formatDate(date));
                
                // Generate slightly varying probability for demo purposes
                const variance = (Math.random() - 0.5) * 0.1;
                const prob = Math.max(0, Math.min(1, baseProb + variance * i));
                data.push((prob * 100).toFixed(1));
            }
            
            // Destroy previous chart if it exists
            if (window.droughtChart) {
                window.droughtChart.destroy();
            }
            
            // Create new chart
            window.droughtChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Drought Risk (%)',
                        data: data,
                        borderColor: '#f44336',
                        backgroundColor: 'rgba(244, 67, 54, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Drought Risk (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
        }
        
        function generateHistoricalData() {
            // Generate historical rainfall data for demonstration
            const ctx1 = document.getElementById('rainfall-chart').getContext('2d');
            const ctx2 = document.getElementById('historical-chart').getContext('2d');
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Current year rainfall (simulated)
            const currentYearRainfall = [65, 59, 80, 81, 56, 40, 30, 20, 35, 30, 0, 0];
            
            // Average rainfall (historical)
            const avgRainfall = [75, 70, 85, 90, 70, 60, 55, 50, 65, 75, 70, 80];
            
            // Drought threshold
            const droughtThreshold = Array(12).fill(40);
            
            // Rainfall chart
            if (window.rainfallChart) {
                window.rainfallChart.destroy();
            }
            
            window.rainfallChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'This Year Rainfall (mm)',
                        data: currentYearRainfall,
                        backgroundColor: '#4caf50'
                    }, {
                        label: 'Historical Average (mm)',
                        data: avgRainfall,
                        type: 'line',
                        borderColor: '#2196f3',
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Drought Threshold',
                        data: droughtThreshold,
                        type: 'line',
                        borderColor: '#f44336',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Rainfall (mm)'
                            }
                        }
                    }
                }
            });
            
            // Historical drought chart
            const years = ['2018', '2019', '2020', '2021', '2022', '2023', '2024'];
            const droughtDays = [15, 25, 40, 30, 50, 65, 45];
            
            if (window.historicalChart) {
                window.historicalChart.destroy();
            }
            
            window.historicalChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Drought Days per Year',
                        data: droughtDays,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Drought Days'
                            }
                        }
                    }
                }
            });
        }
        
        // Event handlers
        function setupEventListeners() {
            // Request form submission
            document.getElementById('request-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const requestData = {
                    amount: document.getElementById('request-amount').value,
                    urgency: document.getElementById('request-urgency').value,
                    reason: document.getElementById('request-reason').value,
                    location: document.getElementById('request-location').value
                };
                
                try {
                    await saveRequest(requestData);
                    // Clear form
                    e.target.reset();
                    // Switch to dashboard
                    switchTab('dashboard');
                } catch (error) {
                    console.error("Request submission error:", error);
                }
            });
            
            // Supply form submission
            document.getElementById('supply-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const supplyData = {
                    amount: document.getElementById('supply-amount').value,
                    duration: document.getElementById('supply-duration').value,
                    quality: document.getElementById('supply-quality').value,
                    location: document.getElementById('supply-location').value,
                    notes: document.getElementById('supply-notes').value
                };
                
                try {
                    await saveSupply(supplyData);
                    // Clear form
                    e.target.reset();
                    // Switch to dashboard
                    switchTab('dashboard');
                } catch (error) {
                    console.error("Supply submission error:", error);
                }
            });
            
            // Profile form submission
            document.getElementById('profile-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const profileData = {
                    name: document.getElementById('profile-name').value,
                    email: document.getElementById('profile-email').value,
                    phone: document.getElementById('profile-phone').value,
                    address: document.getElementById('profile-address').value,
                    city: document.getElementById('profile-city').value,
                    zipcode: document.getElementById('profile-zipcode').value,
                    notifications: document.getElementById('profile-notifications').value
                };
                
                try {
                    await saveUserProfile(profileData);
                } catch (error) {
                    console.error("Profile update error:", error);
                }
            });
            
            // Alert settings form submission
            document.getElementById('alert-settings-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const alertThreshold = document.getElementById('alert-threshold').value;
                const alertNotification = document.getElementById('alert-notification').value;
                
                showAlert("Alert settings saved successfully", "success");
            });
            
            // User search
            document.getElementById('search-button').addEventListener('click', async () => {
                const query = document.getElementById('user-search').value.trim();
                
                if (query.length < 2) {
                    showAlert("Please enter at least 2 characters for search", "warning");
                    return;
                }
                
                try {
                    const results = await searchUsers(query);
                    displaySearchResults(results);
                } catch (error) {
                    console.error("Search error:", error);
                }
            });
        }
        
        // Action functions
        function cancelRequest(requestId) {
            try {
                showAlert("Cancelling water request...", "info");
                
                // Find the request
                const requestIndex = requests.findIndex(req => req._id === requestId);
                
                if (requestIndex !== -1) {
                    // Update status
                    requests[requestIndex].status = 'cancelled';
                    
                    // Update UI
                    updateRequestsUI();
                    updateDashboard();
                    
                    showAlert("Water request cancelled successfully", "success");
                }
            } catch (error) {
                console.error("Error cancelling request:", error);
                showAlert("Failed to cancel water request. Please try again.", "danger");
            }
        }
        
        function cancelSupply(supplyId) {
            try {
                showAlert("Cancelling water supply offering...", "info");
                
                // Find the supply
                const supplyIndex = supplies.findIndex(sup => sup._id === supplyId);
                
                if (supplyIndex !== -1) {
                    // Update status
                    supplies[supplyIndex].status = 'cancelled';
                    
                    // Update UI
                    updateSupplyUI();
                    updateDashboard();
                    
                    showAlert("Water supply offering cancelled successfully", "success");
                }
            } catch (error) {
                console.error("Error cancelling supply:", error);
                showAlert("Failed to cancel water supply offering. Please try again.", "danger");
            }
        }
        
        function respondToRequest(requestId) {
            // Find the request
            const request = requests.find(req => req._id === requestId);
            
            if (request) {
                // Show confirmation dialog
                if (confirm(`Do you want to respond to ${request.userName}'s request for ${request.amount} liters of water?`)) {
                    // In a real app, this would open a chat or messaging interface
                    showAlert("Contact initiated. Please coordinate water delivery directly.", "success");
                }
            }
        }
        
        function requestSupply(supplyId) {
            // Find the supply
            const supply = supplies.find(sup => sup._id === supplyId);
            
            if (supply) {
                // Show confirmation dialog
                if (confirm(`Do you want to request ${supply.amount} liters of water from ${supply.userName}?`)) {
                    // In a real app, this would open a chat or messaging interface
                    showAlert("Request sent. Please coordinate water pickup directly.", "success");
                }
            }
        }
        
        function displaySearchResults(results) {
            const resultsElem = document.getElementById('search-results');
            
            if (results.length === 0) {
                resultsElem.innerHTML = '<p>No users found matching your search criteria.</p>';
            } else {
                let html = '<div class="grid">';
                
                results.forEach(user => {
                    html += `
                        <div class="card">
                            <h3 class="card-title">${user.name}</h3>
                            <p><strong>Location:</strong> ${user.city}</p>
                            <p><strong>Contact:</strong> ${user.email}</p>
                            <button onclick="contactUser('${user._id}')">Contact</button>
                        </div>
                    `;
                });
                
                html += '</div>';
                resultsElem.innerHTML = html;
            }
        }
        
        function contactUser(userId) {
            // Find the user
            const user = users.find(u => u._id === userId);
            
            if (user) {
                // In a real app, this would open a chat or messaging interface
                showAlert(`Contact initiated with ${user.name}. You can now coordinate water sharing.`, "success");
            }
        }
        
        // Utility functions
        function switchTab(tabId) {
            // Update active tab button
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') === `switchTab('${tabId}')`) {
                    link.classList.add('active');
                }
            });
            
            // Hide all tab panes
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabPanes.forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }
        
        function formatDate(dateObj) {
            const date = new Date(dateObj);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alertId = 'alert-' + Date.now();
            
            const alertHtml = `
                <div id="${alertId}" class="alert alert-${type}">
                    ${message}
                </div>
            `;
            
            alertsContainer.innerHTML += alertHtml;
            
            // Auto-remove alert after 5 seconds
            setTimeout(() => {
                const alertElem = document.getElementById(alertId);
                if (alertElem) {
                    alertElem.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>