
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #0d47a1;
            --light-color: #e3f2fd;
            --dark-color: #0a2351;
            --warning-color: #ffb74d;
            --danger-color: #ef5350;
            --success-color: #4caf50;
            --gray-color: #f5f7fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9fbff;
            color: #333;
            line-height: 1.6;
        }

        .full-width-container {
            width: 100%;
            max-width: 1400px; /* Adjust as needed */
            margin: 0 auto;
            padding: 0 20px; /* This creates the gaps on the sides */
        }

        /* Navigation */
        nav {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            font-size: 1.75rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        nav ul li a:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .hero {
            background: linear-gradient(rgba(14, 62, 151, 0.7), rgba(9, 32, 63, 0.8)), url('/api/placeholder/1200/400') center/cover no-repeat;
            color: white;
            padding: 5rem 0;
            text-align: center;
            border-radius: 0 0 30px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(30, 136, 229, 0.2);
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 2.5rem;
            line-height: 1.8;
        }

        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 28px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .main-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin: 40px 0;
        }

        @media (min-width: 768px) {
            .main-sections {
                grid-template-columns: 2fr 1fr;
            }
        }

        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(30, 136, 229, 0.1);
            padding: 25px;
            margin-bottom: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 5px solid var(--primary-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(30, 136, 229, 0.15);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
            font-size: 1.8rem;
            position: relative;
        }

        .card h2::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background-color: var(--primary-color);
        }

        #map-container {
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        #community-map-container {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        .map-info-box {
            background-color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 300px;
        }

        .weather-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 12px;
            background-color: var(--light-color);
            border-radius: 10px;
        }

        .weather-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .forecast-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            box-shadow: 0 3px 10px rgba(30, 136, 229, 0.1);
        }

        .forecast-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(30, 136, 229, 0.2);
        }

        .forecast-item .day {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: var(--light-color);
            margin-bottom: 0;
        }

        .message {
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 18px;
            max-width: 80%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background-color: white;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
            padding: 15px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }

        .results {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.1);
        }

        .results h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .result-item span {
            font-weight: bold;
            color: var(--primary-color);
        }

        .community-project {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }

        .community-project:hover {
            transform: translateX(5px);
        }

        .community-project h3 {
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .community-actions {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 3rem 0 2rem;
            margin-top: 50px;
            border-radius: 30px 30px 0 0;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 15px;
            font-size: 1.3rem;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: var(--primary-color);
        }

        .footer-section p, .footer-section a {
            color: #ccc;
            margin-bottom: 12px;
            display: block;
            text-decoration: none;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .footer-section a:hover {
            color: var(--primary-color);
            transform: translateX(5px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 220px;
            background-color: var(--dark-color);
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 130%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.6s ease-out;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .card:nth-child(3) {
            animation-delay: 0.4s;
        }
    </style>
</head>
<body>
    <div class="full-width-container">
        <!-- Navigation -->
        <nav>
            <div class="nav-content">
                <div class="logo">
                    <i class="fas fa-tint"></i>
                    <span>AquaSync</span>
                </div>
                <ul>
                    <li><a href="#rainwater-map">Map</a></li>
                    <li><a href="#calculator">Calculator</a></li>
                    <li><a href="#community">Community</a></li>
                </ul>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <a href="#rainwater-map" class="btn">Explore Harvesting Map</a>
        </section>

        <!-- Main Content -->
        <div class="main-sections">
            <div class="left-column">
                <!-- Rainwater Map Section -->
                <section id="rainwater-map" class="card">
                    <h2><i class="fas fa-map-marked-alt"></i> Rainwater Harvesting Map</h2>
                    <p>Click on any location to discover rainwater harvesting suitability and get personalized water conservation tips.</p>
                    <div id="map-container"></div>
                    <div class="map-legend" style="margin-top: 10px;">
                        <p><strong>Legend:</strong></p>
                        <div style="display: flex; gap: 20px; margin-top: 5px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background-color: #27ae60; border-radius: 50%;"></div>
                                <span>High Suitability</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background-color: #f1c40f; border-radius: 50%;"></div>
                                <span>Medium Suitability</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background-color: #e74c3c; border-radius: 50%;"></div>
                                <span>Low Suitability</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Weather Recommendations Section -->
                <section id="weather-rec" class="card">
                    <h2><i class="fas fa-cloud-rain"></i> Weather-Based Recommendations</h2>
                    <div class="weather-container">
                        <div class="weather-info">
                            <div class="weather-icon">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <div>
                                <h3>Current Weather</h3>
                                <p id="current-weather">Loading weather data...</p>
                                <p id="weather-recommendation"></p>
                            </div>
                        </div>
                        <h3>5-Day Forecast</h3>
                        <div id="forecast-container" class="forecast-container">
                            <div class="loading"></div>
                        </div>
                        <h3>Rainfall Trends</h3>
                        <div id="rainfall-chart" style="height: 200px; background-color: var(--light-color); border-radius: 5px; padding: 10px; margin-top: 10px;">
                            <p style="text-align:center; padding-top: 80px;">Historical rainfall data will appear here</p>
                        </div>
                    </div>
                </section>

                <!-- AI Chatbot Section -->
                <section id="water-ai" class="card">
                    <h2><i class="fas fa-robot"></i> WaterWise AI Assistant</h2>
                    <div class="chat-container">
                        <div id="chat-messages" class="chat-messages">
                            <div class="message bot-message">
                                Hello! I'm your WaterWise AI Assistant. Ask me anything about rainwater harvesting, water storage, conservation techniques, or related policies.
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chat-input" placeholder="Type your question here...">
                            <button class="btn" id="send-chat"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </section>
            </div>

            <div class="right-column">
                <!-- Water Usage Calculator Section -->
                <section id="calculator" class="card">
                    <h2><i class="fas fa-calculator"></i> Water Usage Calculator</h2>
                    <form id="calculator-form">
                        <div class="form-group">
                            <label for="roof-area">Roof Area (m²)</label>
                            <input type="number" id="roof-area" placeholder="Enter your roof area" required>
                        </div>
                        <div class="form-group">
                            <label for="household-members">Number of Household Members</label>
                            <input type="number" id="household-members" placeholder="Enter number of people" required>
                        </div>
                        <div class="form-group">
                            <label for="daily-usage">Average Daily Water Usage (liters)</label>
                            <input type="number" id="daily-usage" placeholder="Enter daily water usage" required>
                        </div>
                        <button type="submit" class="btn">Calculate Potential</button>
                    </form>
                    <div id="calculator-results" class="results hidden">
                        <h3>Results</h3>
                        <div class="result-item">
                            <p>Potential Rainwater Collection: <span id="potential-collection">0</span> liters/year</p>
                        </div>
                        <div class="result-item">
                            <p>Percentage of Annual Needs: <span id="needs-percentage">0</span>%</p>
                        </div>
                        <div class="result-item">
                            <p>Recommended Storage Capacity: <span id="storage-recommendation">0</span> liters</p>
                        </div>
                        <h3>Water-Saving Strategies</h3>
                        <ul id="strategies-list">
                        </ul>
                    </div>
                </section>

                <!-- Community Projects Section -->
                <section id="community" class="card">
                    <h2><i class="fas fa-users"></i> Community Water Projects</h2>
                    <p>Explore water conservation projects shared by community members or add your own.</p>
                    <div id="community-map-container"></div>
                    <div class="community-actions">
                        <button class="btn" id="add-project-btn"><i class="fas fa-plus"></i> Add Your Project</button>
                    </div>
                    <div id="project-form" class="hidden" style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="project-title">Project Title</label>
                            <input type="text" id="project-title" placeholder="Enter project title">
                        </div>
                        <div class="form-group">
                            <label for="project-desc">Description</label>
                            <input type="text" id="project-desc" placeholder="Brief description">
                        </div>
                        <div class="form-group">
                            <label for="project-type">Project Type</label>
                            <select id="project-type" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="rainwater">Rainwater Harvesting</option>
                                <option value="greywater">Greywater System</option>
                                <option value="conservation">Water Conservation</option>
                                <option value="groundwater">Groundwater Recharge</option>
                            </select>
                        </div>
                        <button class="btn" id="submit-project">Submit Project</button>
                    </div>
                    <div id="community-projects" style="margin-top: 15px;">
                        <h3>Recent Projects</h3>
                        <div id="projects-list">
                            <p>Loading community projects...</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Footer -->
       

    <!-- Add Project Modal -->
    <div id="project-modal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1001;
        justify-content: center;
        align-items: center;">
        <div style="
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 500px;">
            <h2 style="margin-bottom: 15px;">Add Your Water Conservation Project</h2>
            <p>Click on the map to select your project location.</p>
            <div id="modal-map-container" style="height: 300px; margin: 15px 0;"></div>
            <div class="form-group">
                <label for="modal-project-title">Project Title</label>
                <input type="text" id="modal-project-title" placeholder="Enter project title">
            </div>
            <div class="form-group">
                <label for="modal-project-desc">Description</label>
                <input type="text" id="modal-project-desc" placeholder="Brief description">
            </div>
            <div class="form-group">
                <label for="modal-project-type">Project Type</label>
                <select id="modal-project-type" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="rainwater">Rainwater Harvesting</option>
                    <option value="greywater">Greywater System</option>
                    <option value="conservation">Water Conservation</option>
                    <option value="groundwater">Groundwater Recharge</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                <button id="modal-cancel" class="btn" style="background-color: #e74c3c;">Cancel</button>
                <button id="modal-submit" class="btn">Submit Project</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const OPENWEATHER_API_KEY = '30b57a5487db153e1bdf17c1e9d33f44';
        const GEMINI_API_KEY = 'AIzaSyDlIRYdegfbkLXq83OBIotfavhoXHqdHvE';
        let currentPosition = { lat: 40.7128, lng: -74.0060 }; // Default to NYC
        let mainMap, communityMap, modalMap;
        let projectMarker = null;
        let communityProjects = [];

        // Sample rainwater harvesting suitability data (would come from backend in a real app)
        const rainwaterHotspots = [
            { lat: 40.7128, lng: -74.0060, rating: 'high', name: 'Downtown Collection Center' },
            { lat: 40.7328, lng: -73.9860, rating: 'medium', name: 'Midtown Harvesting Zone' },
            { lat: 40.6928, lng: -74.0260, rating: 'low', name: 'Southern District Area' },
            { lat: 40.7528, lng: -73.9660, rating: 'high', name: 'Northern Collection Point' },
            { lat: 40.7028, lng: -73.9960, rating: 'medium', name: 'Eastern Water Zone' },
        ];

        // Sample community projects (would come from backend in a real app)
        const sampleProjects = [
            { lat: 40.7228, lng: -74.0160, type: 'rainwater', title: 'Community Garden Harvesting', description: 'Rainwater collection for local garden irrigation' },
            { lat: 40.7328, lng: -73.9960, type: 'greywater', title: 'Apartment Complex Recycling', description: 'Greywater recycling system for 50-unit building' },
            { lat: 40.7028, lng: -74.0060, type: 'conservation', title: 'School Water Conservation', description: 'Educational program and retrofitted fixtures' },
        ];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            getUserLocation();
            initMaps();
            setupCalculator();
            setupChatbot();
            setupProjectsForm();
            loadSampleProjects();
        });

        // Get user's location if available
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        if (mainMap) {
                            mainMap.setView([currentPosition.lat, currentPosition.lng], 12);
                            getWeatherData(currentPosition.lat, currentPosition.lng);
                        }
                    },
                    () => {
                        console.log('Could not get location, using default');
                        getWeatherData(currentPosition.lat, currentPosition.lng);
                    }
                );
            } else {
                console.log('Geolocation not supported, using default');
                getWeatherData(currentPosition.lat, currentPosition.lng);
            }
        }

        // Initialize maps
        function initMaps() {
            // Main rainwater harvesting map
            mainMap = L.map('map-container').setView([currentPosition.lat, currentPosition.lng], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mainMap);

            // Add rainwater hotspots to the map
            rainwaterHotspots.forEach(spot => {
                let markerColor;
                switch(spot.rating) {
                    case 'high': markerColor = '#27ae60'; break;
                    case 'medium': markerColor = '#f1c40f'; break;
                    case 'low': markerColor = '#e74c3c'; break;
                    default: markerColor = '#3498db';
                }
                
                const marker = L.circleMarker([spot.lat, spot.lng], {
                    radius: 8,
                    fillColor: markerColor,
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(mainMap);

                marker.on('click', () => showLocationInfo(spot, marker));
            });

            // Handle map clicks for custom locations
            mainMap.on('click', (e) => {
                showCustomLocationInfo(e.latlng);
            });

            // Community projects map
            communityMap = L.map('community-map-container').setView([currentPosition.lat, currentPosition.lng], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(communityMap);

            // Initialize modal map (will be set up when modal opens)
        }

        // Show info for predefined hotspots
        function showLocationInfo(spot, marker) {
            const ratingText = {
                'high': 'High suitability for rainwater harvesting.',
                'medium': 'Medium suitability for rainwater harvesting.',
                'low': 'Low suitability for rainwater harvesting.'
            };

            const conservationTips = {
                'high': [
                    'Install large-capacity rain barrels or cisterns.',
                    'Create a rain garden to maximize absorption.',
                    'Use permeable pavement for driveways and walkways.'
                ],
                'medium': [
                    'Install rain barrels at downspouts.',
                    'Implement drip irrigation systems.',
                    'Use mulch in gardens to retain moisture.'
                ],
                'low': [
                    'Focus on water-saving fixtures indoors.',
                    'Plant drought-resistant native species.',
                    'Consider greywater recycling systems.'
                ]
            };

            let popupContent = `
                <div class="map-info-box">
                    <h3>${spot.name}</h3>
                    <p><strong>${ratingText[spot.rating]}</strong></p>
                    <h4>Conservation Tips:</h4>
                    <ul>
                        ${conservationTips[spot.rating].map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            `;

            L.popup()
                .setLatLng([spot.lat, spot.lng])
                .setContent(popupContent)
                .openOn(mainMap);
        }

        // Show info for custom clicked locations
        function showCustomLocationInfo(latlng) {
            // In a real app, we would check rainwater suitability with backend data
            // Here we'll generate a random rating
            const ratings = ['high', 'medium', 'low'];
            const randomRating = ratings[Math.floor(Math.random() * ratings.length)];
            
            const conservationTips = {
                'high': [
                    'Install large-capacity rain barrels or cisterns.',
                    'Create a rain garden to maximize absorption.',
                    'Use permeable pavement for driveways and walkways.'
                ],
                'medium': [
                    'Install rain barrels at downspouts.',
                    'Implement drip irrigation systems.',
                    'Use mulch in gardens to retain moisture.'
                ],
                'low': [
                    'Focus on water-saving fixtures indoors.',
                    'Plant drought-resistant native species.',
                    'Consider greywater recycling systems.'
                ]
            };

            const ratingText = {
                'high': 'High suitability for rainwater harvesting.',
                'medium': 'Medium suitability for rainwater harvesting.',
                'low': 'Low suitability for rainwater harvesting.'
            };

            // Get weather forecast for this location
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latlng.lat}&lon=${latlng.lng}&appid=${OPENWEATHER_API_KEY}&units=metric`)
                .then(response => response.json())
                .then(data => {
                    const location = data.name || 'Custom Location';
                    const currentRain = data.rain ? `${data.rain['1h']} mm in last hour` : 'No recent rainfall';
                    
                    let popupContent = `
                        <div class="map-info-box">
                            <h3>${location}</h3>
                            <p><strong>${ratingText[randomRating]}</strong></p>
                            <p>Current Weather: ${data.weather[0].description}</p>
                            <p>Rainfall: ${currentRain}</p>
                            <h4>Conservation Tips:</h4>
                            <ul>
                                ${conservationTips[randomRating].map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>
                    `;

                    L.popup()
                        .setLatLng(latlng)
                        .setContent(popupContent)
                        .openOn(mainMap);
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    
                    // Fallback popup without weather data
                    let popupContent = `
                        <div class="map-info-box">
                            <h3>Custom Location</h3>
                            <p><strong>${ratingText[randomRating]}</strong></p>
                            <h4>Conservation Tips:</h4>
                            <ul>
                                ${conservationTips[randomRating].map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>
                    `;

                    L.popup()
                        .setLatLng(latlng)
                        .setContent(popupContent)
                        .openOn(mainMap);
                });
        }

        // Get weather data from OpenWeather API
        function getWeatherData(lat, lng) {
            // Get current weather
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${OPENWEATHER_API_KEY}&units=metric`)
                .then(response => response.json())
                .then(data => {
                    const weatherElement = document.getElementById('current-weather');
                    const locationName = data.name;
                    const tempC = Math.round(data.main.temp);
                    const description = data.weather[0].description;
                    const humidity = data.main.humidity;
                    
                    weatherElement.innerHTML = `
                        <strong>${locationName}</strong>: ${tempC}°C, ${description}<br>
                        Humidity: ${humidity}%
                    `;
                    
                    // Add recommendation based on weather
                    const recElement = document.getElementById('weather-recommendation');
                    if (data.rain) {
                        recElement.innerHTML = `<strong>Great news!</strong> It's raining right now - perfect for rainwater harvesting. Make sure your collection systems are ready.`;
                    } else if (data.clouds.all > 75) {
                        recElement.innerHTML = `<strong>Rain may be coming soon.</strong> Check that your rainwater collection systems are prepared.`;
                    } else {
                        recElement.innerHTML = `<strong>No immediate rain predicted.</strong> A good time to maintain and clean your rainwater collection systems.`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching current weather:', error);
                    document.getElementById('current-weather').innerHTML = 'Unable to load current weather data.';
                });
                
            // Get 5-day forecast
            fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lng}&appid=${OPENWEATHER_API_KEY}&units=metric`)
                .then(response => response.json())
                .then(data => {
                    const forecastContainer = document.getElementById('forecast-container');
                    forecastContainer.innerHTML = '';
                    
                    // Process forecast data - take one forecast per day
                    const dailyForecasts = [];
                    const today = new Date().getDate();
                    
                    data.list.forEach(forecast => {
                        const forecastDate = new Date(forecast.dt * 1000);
                        const forecastDay = forecastDate.getDate();
                        
                        // Only add if it's a new day and we have less than 5 days
                        if (forecastDay > today && dailyForecasts.length < 5 && !dailyForecasts.some(f => new Date(f.dt * 1000).getDate() === forecastDay)) {
                            dailyForecasts.push(forecast);
                        }
                    });
                    
                    // Display forecasts
                    dailyForecasts.forEach(forecast => {
                        const date = new Date(forecast.dt * 1000);
                        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                        const tempC = Math.round(forecast.main.temp);
                        const icon = forecast.weather[0].icon;
                        const description = forecast.weather[0].description;
                        const precipitation = forecast.pop * 100; // Probability of precipitation in %
                        
                        const forecastItem = document.createElement('div');
                        forecastItem.className = 'forecast-item';
                        forecastItem.innerHTML = `
                            <div class="day">${dayName}</div>
                            <div style="font-size: 1.5rem;">
                                <i class="fas ${getWeatherIcon(icon)}"></i>
                            </div>
                            <div>${tempC}°C</div>
                            <div>${description}</div>
                            <div>Rain: ${precipitation}%</div>
                        `;
                        
                        forecastContainer.appendChild(forecastItem);
                    });
                    
                    // Create very basic rainfall chart data
                    const rainfallData = dailyForecasts.map(forecast => forecast.pop * 100);
                    const days = dailyForecasts.map(forecast => {
                        const date = new Date(forecast.dt * 1000);
                        return date.toLocaleDateString('en-US', { weekday: 'short' });
                    });
                    
                    createRainfallChart(days, rainfallData);
                })
                .catch(error => {
                    console.error('Error fetching forecast:', error);
                    document.getElementById('forecast-container').innerHTML = 'Unable to load forecast data.';
                });
        }
        
        // Map OpenWeather icons to FontAwesome icons
        function getWeatherIcon(iconCode) {
            const iconMap = {
                '01d': 'fa-sun', // clear sky day
                '01n': 'fa-moon', // clear sky night
                '02d': 'fa-cloud-sun', // few clouds day
                '02n': 'fa-cloud-moon', // few clouds night
                '03d': 'fa-cloud', // scattered clouds
                '03n': 'fa-cloud',
                '04d': 'fa-cloud', // broken clouds
                '04n': 'fa-cloud',
                '09d': 'fa-cloud-showers-heavy', // shower rain
                '09n': 'fa-cloud-showers-heavy',
                '10d': 'fa-cloud-rain', // rain day
                '10n': 'fa-cloud-rain', // rain night
                '11d': 'fa-bolt', // thunderstorm
                '11n': 'fa-bolt',
                '13d': 'fa-snowflake', // snow
                '13n': 'fa-snowflake',
                '50d': 'fa-smog', // mist
                '50n': 'fa-smog'
            };
            
            return iconMap[iconCode] || 'fa-cloud';
        }
        
        // Create a basic rainfall chart
        function createRainfallChart(days, rainfallData) {
            const chartContainer = document.getElementById('rainfall-chart');
            chartContainer.innerHTML = '';
            
            const chartHeight = 150;
            const maxRainfall = Math.max(...rainfallData);
            
            const chart = document.createElement('div');
            chart.style.display = 'flex';
            chart.style.alignItems = 'flex-end';
            chart.style.height = chartHeight + 'px';
            chart.style.gap = '10px';
            chart.style.justifyContent = 'space-between';
            
            rainfallData.forEach((value, index) => {
                const barHeight = (value / maxRainfall) * chartHeight || 5; // Minimum height of 5px
                
                const barContainer = document.createElement('div');
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                barContainer.style.width = `${100 / rainfallData.length}%`;
                
                const bar = document.createElement('div');
                bar.style.width = '20px';
                bar.style.height = barHeight + 'px';
                bar.style.backgroundColor = '#3498db';
                bar.style.borderRadius = '3px 3px 0 0';
                
                const label = document.createElement('div');
                label.textContent = days[index];
                label.style.marginTop = '5px';
                label.style.fontSize = '0.8rem';
                
                const valueLabel = document.createElement('div');
                valueLabel.textContent = `${Math.round(value)}%`;
                valueLabel.style.marginBottom = '5px';
                valueLabel.style.fontSize = '0.8rem';
                
                barContainer.appendChild(valueLabel);
                barContainer.appendChild(bar);
                barContainer.appendChild(label);
                chart.appendChild(barContainer);
            });
            
            chartContainer.appendChild(chart);
        }
        
        // Set up water usage calculator
        function setupCalculator() {
            const calculatorForm = document.getElementById('calculator-form');
            const calculatorResults = document.getElementById('calculator-results');
            
            calculatorForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const roofArea = parseFloat(document.getElementById('roof-area').value);
                const householdMembers = parseInt(document.getElementById('household-members').value);
                const dailyUsage = parseFloat(document.getElementById('daily-usage').value);
                
                // Calculate potential collection (average annual rainfall * roof area * collection efficiency)
                // Using 800mm as sample annual rainfall - in a real app, this would come from location data
                const annualRainfall = 800; // mm
                const collectionEfficiency = 0.8; // 80% collection efficiency
                
                const potentialCollection = roofArea * (annualRainfall / 1000) * collectionEfficiency * 1000; // liters
                const annualWaterNeeds = dailyUsage * 365;
                const needsPercentage = (potentialCollection / annualWaterNeeds) * 100;
                
                // Recommend storage capacity (2-month supply is typical)
                const storageRecommendation = Math.round(potentialCollection * (2 / 12));
                
                // Show results
                document.getElementById('potential-collection').textContent = Math.round(potentialCollection).toLocaleString();
                document.getElementById('needs-percentage').textContent = needsPercentage.toFixed(1);
                document.getElementById('storage-recommendation').textContent = storageRecommendation.toLocaleString();
                
                // Generate water-saving strategies based on inputs
                const strategiesList = document.getElementById('strategies-list');
                strategiesList.innerHTML = '';
                
                const strategies = [
                    'Install low-flow toilets to save up to 60% water per flush.',
                    'Use water-efficient showerheads to reduce usage by 40%.',
                    'Fix leaks promptly - a dripping faucet can waste 3,000+ gallons annually.',
                    'Collect shower warm-up water in a bucket for plants.',
                    'Install water-efficient dishwashers and washing machines.'
                ];
                
                // Add household-specific strategies
                if (householdMembers > 3) {
                    strategies.push('Consider a greywater recycling system for larger households.');
                }
                
                if (needsPercentage < 30) {
                    strategies.push('Consider additional water conservation measures due to low rainfall collection potential.');
                }
                
                if (roofArea > 150) {
                    strategies.push('With your large roof area, consider multiple collection points and larger storage capacity.');
                }
                
                strategies.forEach(strategy => {
                    const li = document.createElement('li');
                    li.textContent = strategy;
                    strategiesList.appendChild(li);
                });
                
                calculatorResults.classList.remove('hidden');
            });
        }
        
        // Set up AI chatbot
        // Set up AI chatbot with Groq API
function setupChatbot() {
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-chat');
    const chatMessages = document.getElementById('chat-messages');
    
    // Replace Gemini API key with Groq API key
    const GROQ_API_KEY = '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';
    const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';
    
    function addMessage(text, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
        messageDiv.textContent = text;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    async function sendToGroq(userMessage) {
        try {
            // Add loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot-message loading';
            loadingDiv.textContent = 'Thinking...';
            chatMessages.appendChild(loadingDiv);
            
            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${GROQ_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama3-8b-8192', // You can change to another model Groq offers
                    messages: [
                        {
                            role: 'system',
                            content: 'You are WaterWise AI Assistant, an expert in rainwater harvesting, water conservation, storage techniques, and related policies. Provide helpful, concise answers with practical advice. Focus on being informative and educational about water conservation topics.'
                        },
                        {
                            role: 'user',
                            content: userMessage
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 500
                })
            });
            
            // Remove loading indicator
            chatMessages.removeChild(loadingDiv);
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content;
        } catch (error) {
            console.error('Error calling Groq API:', error);
            return "I'm having trouble connecting right now. Please try again later, or ask about rainwater harvesting, water storage, conservation techniques, or water policies.";
        }
    }
    
    // Fallback responses for when API is unavailable
    const fallbackResponses = {
        'rainwater': 'Rainwater harvesting is the collection and storage of rain for reuse on-site. It can provide water for garden and crop irrigation, livestock, indoor plants, toilet flushing, and even for drinking with proper treatment. The most common method involves collecting rainwater from roof surfaces.',
        'storage': 'Water storage options range from small rain barrels (50-100 gallons) to large cisterns (1,000+ gallons). Materials include plastic, concrete, metal, or fiberglass. Consider factors like capacity needed, available space, budget, and local regulations when choosing a system.',
        'conservation': 'Effective water conservation strategies include installing water-efficient fixtures, fixing leaks promptly, using drought-resistant landscaping, collecting shower water while it warms up, and implementing greywater recycling systems for appropriate uses.',
        'policy': 'Water conservation policies vary by location. Many regions offer incentives for rainwater collection systems. Check with your local water authority for specific guidelines and potential assistance programs.',
        'groundwater': 'Groundwater recharge is crucial for sustainable water management. You can help by creating rain gardens, bioswales, or permeable surfaces that allow water to penetrate rather than run off, replenishing aquifers and maintaining water tables.'
    };
    
    async function handleSendMessage() {
        const message = chatInput.value.trim();
        if (message) {
            addMessage(message, true);
            chatInput.value = '';
            
            try {
                // Call Groq API for dynamic responses
                const response = await sendToGroq(message);
                addMessage(response);
            } catch (error) {
                console.error('Error handling message:', error);
                
                // Use fallback responses if API fails
                let fallbackResponse = "I don't have specific information about that. Could you ask about rainwater harvesting, water storage, conservation techniques, or water policies?";
                
                // Check for keywords in the message
                const messageLower = message.toLowerCase();
                if (messageLower.includes('rainwater') || messageLower.includes('harvest')) {
                    fallbackResponse = fallbackResponses.rainwater;
                } else if (messageLower.includes('storage') || messageLower.includes('tank') || messageLower.includes('barrel')) {
                    fallbackResponse = fallbackResponses.storage;
                } else if (messageLower.includes('conservation') || messageLower.includes('save') || messageLower.includes('efficient')) {
                    fallbackResponse = fallbackResponses.conservation;
                } else if (messageLower.includes('policy') || messageLower.includes('regulation') || messageLower.includes('law')) {
                    fallbackResponse = fallbackResponses.policy;
                } else if (messageLower.includes('groundwater') || messageLower.includes('aquifer') || messageLower.includes('recharge')) {
                    fallbackResponse = fallbackResponses.groundwater;
                }
                
                addMessage(fallbackResponse);
            }
        }
    }
    
    sendButton.addEventListener('click', handleSendMessage);
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            handleSendMessage();
        }
    });
}
        // Set up community projects functionality
        function setupProjectsForm() {
            const addProjectBtn = document.getElementById('add-project-btn');
            const projectModal = document.getElementById('project-modal');
            const modalCancel = document.getElementById('modal-cancel');
            const modalSubmit = document.getElementById('modal-submit');
            
            addProjectBtn.addEventListener('click', function() {
                projectModal.style.display = 'flex';
                
                // Initialize modal map if not done already
                if (!modalMap) {
                    modalMap = L.map('modal-map-container').setView([currentPosition.lat, currentPosition.lng], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(modalMap);
                    
                    // Allow user to click to place marker
                    modalMap.on('click', function(e) {
                        if (projectMarker) {
                            modalMap.removeLayer(projectMarker);
                        }
                        projectMarker = L.marker(e.latlng).addTo(modalMap);
                    });
                }
                
                // Reset modal map view
                modalMap.invalidateSize();
                modalMap.setView([currentPosition.lat, currentPosition.lng], 13);
            });
            
            modalCancel.addEventListener('click', function() {
                projectModal.style.display = 'none';
                if (projectMarker) {
                    modalMap.removeLayer(projectMarker);
                    projectMarker = null;
                }
            });
            
            modalSubmit.addEventListener('click', function() {
                if (!projectMarker) {
                    alert('Please select a location on the map');
                    return;
                }
                
                const title = document.getElementById('modal-project-title').value.trim();
                const description = document.getElementById('modal-project-desc').value.trim();
                const projectType = document.getElementById('modal-project-type').value;
                
                if (!title || !description) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Add new project
                const newProject = {
                    lat: projectMarker.getLatLng().lat,
                    lng: projectMarker.getLatLng().lng,
                    type: projectType,
                    title: title,
                    description: description
                };
                
                communityProjects.push(newProject);
                addProjectToMap(newProject);
                addProjectToList(newProject);
                
                // Close modal and reset
                projectModal.style.display = 'none';
                modalMap.removeLayer(projectMarker);
                projectMarker = null;
                document.getElementById('modal-project-title').value = '';
                document.getElementById('modal-project-desc').value = '';
            });
        }
        
        // Load sample community projects
        function loadSampleProjects() {
            communityProjects = [...sampleProjects];
            
            // Clear projects list
            document.getElementById('projects-list').innerHTML = '';
            
            // Add projects to map and list
            communityProjects.forEach(project => {
                addProjectToMap(project);
                addProjectToList(project);
            });
        }
        
        // Add project to community map
        function addProjectToMap(project) {
            // Choose icon based on project type
            let iconClass;
            switch(project.type) {
                case 'rainwater': iconClass = 'tint'; break;
                case 'greywater': iconClass = 'recycle'; break;
                case 'conservation': iconClass = 'leaf'; break;
                case 'groundwater': iconClass = 'water'; break;
                default: iconClass = 'tint';
            }
            
            // Create custom icon HTML
            const iconHtml = `<div style="background-color: #30b57a; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white;"><i class="fas fa-${iconClass}"></i></div>`;
            const customIcon = L.divIcon({
                html: iconHtml,
                className: '',
                iconSize: [30, 30]
            });
            
            // Add marker to map
            const marker = L.marker([project.lat, project.lng], {icon: customIcon}).addTo(communityMap);
            
            // Add popup with project details
            marker.bindPopup(`
                <div>
                    <h3>${project.title}</h3>
                    <p>${project.description}</p>
                    <p><small>Project type: ${project.type}</small></p>
                </div>
            `);
        }
        
        // Add project to list display
        function addProjectToList(project) {
            const projectsList = document.getElementById('projects-list');
            
            const projectDiv = document.createElement('div');
            projectDiv.className = 'community-project';
            
            // Choose icon based on project type
            let iconClass;
            switch(project.type) {
                case 'rainwater': iconClass = 'tint'; break;
                case 'greywater': iconClass = 'recycle'; break;
                case 'conservation': iconClass = 'leaf'; break;
                case 'groundwater': iconClass = 'water'; break;
                default: iconClass = 'tint';
            }
            
            projectDiv.innerHTML = `
                <h3><i class="fas fa-${iconClass}"></i> ${project.title}</h3>
                <p>${project.description}</p>
            `;
            
            projectsList.appendChild(projectDiv);
        }
    </script>
</body>
</html>